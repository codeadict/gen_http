services:
  httpbin:
    image: docker.io/kennethreitz/httpbin:latest
    ports:
      - "${HTTPBIN_HTTP_PORT:-8080}:80"

  caddy:
    build:
      context: .
      dockerfile: Dockerfile.caddy
    # For local development, set DOCKER_USER to your username in .env
    # to avoid file permission issues. In CI, this defaults to root.
    # Example: DOCKER_USER=$(whoami)
    user: "${DOCKER_USER:-root}"
    environment:
      - HTTPBIN_HTTP_PORT=${HTTPBIN_HTTP_PORT:-8080}
      - HTTPBIN_HTTPS_PORT=${HTTPBIN_HTTPS_PORT:-8443}
    volumes:
      - "./caddy_storage:/caddy_storage"
    ports:
      - "${HTTPBIN_HTTPS_PORT:-8443}:${HTTPBIN_HTTPS_PORT:-8443}"
    depends_on:
      - httpbin
